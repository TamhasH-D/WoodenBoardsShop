<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞</h1>
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç API endpoints, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.</p>
        
        <div class="test-section">
            <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü —Å ID: <code>3ab0f210-ca78-4312-841b-8b1ae774adac</code></p>
            <button onclick="testSeller()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞</button>
            <div id="seller-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞</h3>
            <p>–ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞</p>
            <button onclick="testProducts()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
            <div id="products-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥—Ä–µ–≤–µ—Å–∏–Ω—ã</h3>
            <p>–ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –¥—Ä–µ–≤–µ—Å–∏–Ω—ã</p>
            <button onclick="testWoodTypes()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥—Ä–µ–≤–µ—Å–∏–Ω—ã</button>
            <div id="woodtypes-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
            <p>–°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–Ω–µ–ª–∏</p>
            <button onclick="createTestData()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <div id="testdata-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</p>
            <button onclick="testDataStructure()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
            <div id="structure-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const SELLER_ID = '3ab0f210-ca78-4312-841b-8b1ae774adac';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        async function testSeller() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/sellers/${SELLER_ID}`);
                const data = await response.json();
                showResult('seller-result', {
                    status: response.status,
                    data: data
                });
            } catch (error) {
                showResult('seller-result', {
                    error: error.message,
                    note: 'Backend –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'
                }, true);
            }
        }

        async function testProducts() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/products?offset=0&limit=20`);
                const data = await response.json();
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ seller_id (–∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç frontend)
                const allProducts = data.data || data;
                const sellerProducts = allProducts.filter(product => product.seller_id === SELLER_ID);
                
                showResult('products-result', {
                    status: response.status,
                    total_products: allProducts.length,
                    seller_products: sellerProducts.length,
                    structure: {
                        has_data_field: !!data.data,
                        has_items_field: !!data.items,
                        actual_structure: Object.keys(data)
                    },
                    sample_products: sellerProducts.slice(0, 2)
                });
            } catch (error) {
                showResult('products-result', {
                    error: error.message
                }, true);
            }
        }

        async function testWoodTypes() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/wood-types?offset=0&limit=20`);
                const data = await response.json();
                
                showResult('woodtypes-result', {
                    status: response.status,
                    total: data.pagination?.total || data.total || 0,
                    count: data.data?.length || 0,
                    structure: {
                        has_data_field: !!data.data,
                        has_items_field: !!data.items,
                        actual_structure: Object.keys(data)
                    },
                    sample: data.data?.slice(0, 2) || []
                });
            } catch (error) {
                showResult('woodtypes-result', {
                    error: error.message
                }, true);
            }
        }

        async function createTestData() {
            try {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥–∞–≤—Ü–∞ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                let sellerExists = false;
                try {
                    const sellerResponse = await fetch(`${API_BASE}/api/v1/sellers/${SELLER_ID}`);
                    sellerExists = sellerResponse.ok;
                } catch (e) {
                    // –ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                }

                let results = [];

                if (!sellerExists) {
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥–∞–≤—Ü–∞
                    const sellerData = {
                        id: SELLER_ID,
                        keycloak_uuid: SELLER_ID,
                        is_online: true
                    };
                    
                    const sellerResponse = await fetch(`${API_BASE}/api/v1/sellers`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sellerData)
                    });
                    
                    results.push({
                        action: 'create_seller',
                        status: sellerResponse.status,
                        success: sellerResponse.ok
                    });
                }

                showResult('testdata-result', {
                    results: results,
                    note: '–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω –∑–∞–ø—É—â–µ–Ω–Ω—ã–π backend'
                });
            } catch (error) {
                showResult('testdata-result', {
                    error: error.message
                }, true);
            }
        }

        async function testDataStructure() {
            try {
                const tests = [
                    { name: 'products', url: `${API_BASE}/api/v1/products?offset=0&limit=5` },
                    { name: 'wood-types', url: `${API_BASE}/api/v1/wood-types?offset=0&limit=5` },
                    { name: 'sellers', url: `${API_BASE}/api/v1/sellers?offset=0&limit=5` }
                ];

                const results = {};

                for (const test of tests) {
                    try {
                        const response = await fetch(test.url);
                        const data = await response.json();
                        
                        results[test.name] = {
                            status: response.status,
                            has_data_field: !!data.data,
                            has_items_field: !!data.items,
                            structure: Object.keys(data),
                            data_type: Array.isArray(data.data) ? 'array' : typeof data.data,
                            count: data.data?.length || 0
                        };
                    } catch (error) {
                        results[test.name] = {
                            error: error.message
                        };
                    }
                }

                showResult('structure-result', results);
            } catch (error) {
                showResult('structure-result', {
                    error: error.message
                }, true);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            console.log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤.');
        };
    </script>
</body>
</html>
