# Документация API: Эндпоинты изображений

## Эндпоинты, связанные с изображениями

### Создание изображения (метаданные)

- **Метод:** POST
- **Путь:** `/images/`
- **Описание:** Создает новую запись изображения в БД (только метаданные).

- **Ожидаемые входные данные (ImageInputDTO):**
  ```json
  {
    "id": "UUID", // Уникальный идентификатор изображения
    "image_path": "string", // Путь к файлу изображения
    "product_id": "UUID" // Идентификатор продукта, к которому относится изображение
  }
  ```

- **Формат выходных данных (DataResponse[ImageDTO]):**
  ```json
  {
    "data": {
      "id": "UUID", // Уникальный идентификатор созданного изображения
      "image_path": "string", // Путь к файлу изображения
      "product_id": "UUID" // Идентификатор продукта
    }
  }
  ```

### Загрузка изображения с файлом

- **Метод:** POST
- **Путь:** `/images/upload`
- **Описание:** Загружает файл изображения и создает запись в БД.

- **Параметры запроса:**
  - `product_id` (UUID) - Идентификатор продукта

- **Тело запроса:** multipart/form-data
  - `image` (file) - Файл изображения (JPEG, PNG, WebP, до 10MB)

- **Формат выходных данных (DataResponse[ImageDTO]):**
  ```json
  {
    "data": {
      "id": "UUID", // Автоматически сгенерированный идентификатор
      "image_path": "string", // Путь к сохраненному файлу
      "product_id": "UUID" // Идентификатор продукта
    }
  }
  ```

- **Коды ошибок:**
  - `413` - Файл слишком большой (>10MB)
  - `415` - Неподдерживаемый тип файла
  - `500` - Ошибка сохранения файла или создания записи

### Обновление изображения

- **Метод:** PATCH
- **Путь:** `/images/{image_id}`
- **Описание:** Обновляет существующее изображение по его идентификатору.

- **Параметры пути:**
  - `image_id`: UUID - Уникальный идентификатор изображения, которое нужно обновить.

- **Ожидаемые входные данные (ImageUpdateDTO):**
  ```json
  {
    "image_path": "string | null", // Новый путь к файлу изображения (необязательно)
    "product_id": "UUID | null" // Новый идентификатор продукта (необязательно)
  }
  ```

- **Формат выходных данных (EmptyResponse):**
  ```json
  {
    "data": null
  }
  ```

### Удаление изображения

- **Метод:** DELETE
- **Путь:** `/images/{image_id}`
- **Описание:** Удаляет изображение из БД и файл с диска.

- **Параметры пути:**
  - `image_id`: UUID - Уникальный идентификатор изображения, которое нужно удалить.

- **Формат выходных данных (EmptyResponse):**
  ```json
  {
    "data": null
  }
  ```

- **Коды ошибок:**
  - `404` - Изображение не найдено

### Получение списка изображений с пагинацией

- **Метод:** GET
- **Путь:** `/images/`
- **Описание:** Возвращает список всех изображений с использованием пагинации.

- **Параметры запроса (PaginationParams):
  - `offset`: integer (по умолчанию 0, >=0) - Смещение для пагинации.
  - `limit`: integer (по умолчанию 20, >=1, <=20) - Количество записей на странице.

- **Формат выходных данных (OffsetResults[ImageDTO]):**
  ```json
  {
    "data": [
      {
        "id": "UUID",
        "image_path": "string",
        "product_id": "UUID"
      }
    ],
    "pagination": {
      "total": "integer" // Общее количество изображений
    }
  }
  ```

### Получение метаданных изображения по ID

- **Метод:** GET
- **Путь:** `/images/{image_id}`
- **Описание:** Возвращает метаданные изображения по его идентификатору.

- **Параметры пути:**
  - `image_id`: UUID - Уникальный идентификатор изображения.

- **Формат выходных данных (DataResponse[ImageDTO]):**
  ```json
  {
    "data": {
      "id": "UUID",
      "image_path": "string",
      "product_id": "UUID"
    }
  }
  ```

- **Коды ошибок:**
  - `404` - Изображение не найдено

### Получение файла изображения

- **Метод:** GET
- **Путь:** `/images/{image_id}/file`
- **Описание:** Возвращает файл изображения для отображения в браузере.

- **Параметры пути:**
  - `image_id`: UUID - Уникальный идентификатор изображения.

- **Формат выходных данных:** Файл изображения (image/jpeg, image/png, etc.)
  - Content-Type: image/*
  - Content-Disposition: filename="image_{image_id}.jpg"

- **Коды ошибок:**
  - `404` - Изображение не найдено в БД
  - `404` - Файл изображения не найден на диске

## Примеры использования

### Загрузка изображения с помощью curl

```bash
curl -X POST "http://localhost:8000/api/v1/images/upload?product_id=123e4567-e89b-12d3-a456-426614174000" \
  -H "Content-Type: multipart/form-data" \
  -F "image=@/path/to/image.jpg"
```

### Получение файла изображения

```bash
curl -X GET "http://localhost:8000/api/v1/images/123e4567-e89b-12d3-a456-426614174000/file" \
  --output downloaded_image.jpg
```