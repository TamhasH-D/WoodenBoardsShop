# Diplom Project

Микросервисная архитектура для дипломного проекта.

## Структура проекта

Проект состоит из следующих компонентов:

- **Backend**: Основной бэкенд-сервис
- **Frontend**:
  - **Admin**: Панель администратора
  - **Seller**: Интерфейс для продавцов
  - **Buyer**: Интерфейс для покупателей

## Запуск проекта

Проект можно запустить в двух режимах: разработки (dev) и продакшена (prod). Оба режима настроены в одном файле docker-compose.yml с использованием переменных окружения для переключения между ними.

### Предварительные требования

- Docker
- Docker Compose
- Make

### Режим разработки

В режиме разработки фронтенд-сервисы запускаются с помощью Node.js с возможностью горячей перезагрузки.

```bash
# Сборка и запуск в режиме разработки
make build-dev
make up-dev

# Просмотр логов
make logs
```

### Режим продакшена

В режиме продакшена фронтенд-сервисы запускаются с использованием Nginx для раздачи статических файлов.

```bash
# Сборка и запуск в режиме продакшена
make build-prod
make up-prod

# Или просто (по умолчанию - продакшен)
make build
make up

# Просмотр логов
make logs
```

### Остановка проекта

```bash
make down
```

## Порты по умолчанию

- **Backend**: 8000
- **Admin Frontend**:
  - Разработка: 3000
  - Продакшен: 80
- **Seller Frontend**:
  - Разработка: 3000
  - Продакшен: 80
- **Buyer Frontend**:
  - Разработка: 3000
  - Продакшен: 80

Порты можно изменить через переменные окружения в файле `.env`.

## Переменные окружения

Создайте файл `.env` в корне проекта со следующими переменными:

```
# Порты
BACKEND_PORT=8000
FRONTEND_ADMIN_PORT=8080
FRONTEND_SELLER_PORT=8081
FRONTEND_BUYER_PORT=8082

# Режим (используется автоматически через Makefile)
NODE_ENV=production  # или development
FRONTEND_PORT=80     # или 3000 для разработки
CONTAINER_PORT=80    # или 3000 для разработки
COMPOSE_FILE_EXT=.yaml  # или .dev.yaml для разработки
```

## Команды Makefile

- `make help` - Показать справку
- `make up-dev` - Запустить в режиме разработки
- `make up-prod` - Запустить в режиме продакшена
- `make up` - Запустить в режиме продакшена (по умолчанию)
- `make down` - Остановить все контейнеры
- `make build-dev` - Собрать в режиме разработки
- `make build-prod` - Собрать в режиме продакшена
- `make build` - Собрать в режиме продакшена (по умолчанию)
- `make restart` - Перезапустить все сервисы
- `make logs` - Просмотр логов
- `make ps` - Список запущенных контейнеров

## Как это работает

Переключение между режимами разработки и продакшена происходит с помощью переменных окружения:

1. В режиме разработки:
   - `NODE_ENV=development`
   - `COMPOSE_FILE_EXT=.dev.yaml` (использует docker-compose.dev.yaml)
   - `FRONTEND_PORT=3000` и `CONTAINER_PORT=3000` (для Node.js)

2. В режиме продакшена:
   - `NODE_ENV=production`
   - `COMPOSE_FILE_EXT=.yaml` (использует docker-compose.yaml)
   - `FRONTEND_PORT=80` и `CONTAINER_PORT=80` (для Nginx)

Эти переменные автоматически устанавливаются через Makefile при использовании соответствующих команд.