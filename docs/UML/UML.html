<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UML –î–∏–∞–≥—Ä–∞–º–º—ã - WoodenBoardsShop</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            background: transparent;
            border: none;
            padding: 10px 16px;
            margin: 5px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
            font-size: 0.85rem;
        }

        .tab.active {
            background: #2563eb;
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .tab:hover:not(.active) {
            background: #f1f5f9;
            color: #1e293b;
        }

        .diagram-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            overflow-x: auto;
            display: none;
        }

        .diagram-container.active {
            display: block;
        }

        .diagram-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }

        .mermaid {
            text-align: center;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .description {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .description h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .description-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .description-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #2563eb;
        }

        .description-item h4 {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .description-item p {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow-x: auto;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® UML –î–∏–∞–≥—Ä–∞–º–º—ã</h1>
            <p>Unified Modeling Language –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–∏—Å—Ç–µ–º—ã WoodenBoardsShop - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showDiagram('class')">–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤</button>
            <button class="tab" onclick="showDiagram('sequence')">–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            <button class="tab" onclick="showDiagram('usecase')">–í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</button>
            <button class="tab" onclick="showDiagram('component')">–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</button>
            <button class="tab" onclick="showDiagram('deployment')">–î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è</button>
            <button class="tab" onclick="showDiagram('state')">–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π</button>
        </div>

        <div class="controls">
            <button class="btn" onclick="downloadCurrentDiagram()">üíæ –°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
            <button class="btn" onclick="resetZoom()">‚Üª –°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±</button>
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤ -->
        <div id="class" class="diagram-container active">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤ - –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</div>
            <div class="mermaid">
classDiagram
    class Buyer {
        +UUID id
        +UUID keycloak_uuid
        +bool is_online
        +datetime created_at
        +datetime updated_at
        +List~ChatThread~ chat_threads
        +List~ChatMessage~ chat_messages
    }
    
    class Seller {
        +UUID id
        +UUID keycloak_uuid
        +bool is_online
        +datetime created_at
        +datetime updated_at
        +List~Product~ products
        +List~ChatThread~ chat_threads
        +List~ChatMessage~ chat_messages
    }
    
    class WoodType {
        +UUID id
        +str neme
        +str description
        +List~Product~ products
        +List~WoodTypePrice~ wood_type_prices
    }
    
    class WoodTypePrice {
        +UUID id
        +float price_per_m3
        +datetime created_at
        +UUID wood_type_id
        +WoodType wood_type
    }
    
    class Product {
        +UUID id
        +float volume
        +float price
        +str title
        +str descrioption
        +bool delivery_possible
        +str pickup_location
        +datetime created_at
        +datetime updated_at
        +UUID seller_id
        +UUID wood_type_id
        +Seller seller
        +WoodType wood_type
        +List~Image~ images
    }
    
    class Image {
        +UUID id
        +str image_path
        +UUID product_id
        +Product product
        +WoodenBoard wooden_board
    }
    
    class WoodenBoard {
        +UUID id
        +float height
        +float width
        +float lenght
        +UUID image_id
        +Image image
    }
    
    class ChatThread {
        +UUID id
        +datetime created_at
        +UUID buyer_id
        +UUID seller_id
        +Buyer buyer
        +Seller seller
        +List~ChatMessage~ chat_messages
    }
    
    class ChatMessage {
        +UUID id
        +str message
        +bool is_read_by_buyer
        +bool is_read_by_seller
        +datetime created_at
        +UUID thread_id
        +UUID buyer_id
        +UUID seller_id
        +ChatThread thread
        +Buyer buyer
        +Seller seller
    }
    
    %% Relationships
    Seller ||--o{ Product : creates
    WoodType ||--o{ Product : categorizes
    WoodType ||--o{ WoodTypePrice : has_prices
    Product ||--o{ Image : contains
    Image ||--|| WoodenBoard : analyzed_as
    
    Buyer ||--o{ ChatThread : participates
    Seller ||--o{ ChatThread : participates
    ChatThread ||--o{ ChatMessage : contains
    Buyer ||--o{ ChatMessage : sends
    Seller ||--o{ ChatMessage : sends
            </div>
            
            <div class="description">
                <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤</h3>
                <div class="description-grid">
                    <div class="description-item">
                        <h4>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
                        <p>Buyer –∏ Seller - –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–∫—Ç–µ—Ä—ã —Å–∏—Å—Ç–µ–º—ã —Å –æ–±—â–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏</p>
                    </div>
                    <div class="description-item">
                        <h4>üì¶ –¢–æ–≤–∞—Ä—ã</h4>
                        <p>Product —Å–≤—è–∑–∞–Ω —Å Seller –∏ WoodType, —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏</p>
                    </div>
                    <div class="description-item">
                        <h4>üå≥ –ö–∞—Ç–∞–ª–æ–≥ –¥—Ä–µ–≤–µ—Å–∏–Ω—ã</h4>
                        <p>WoodType –∏ WoodTypePrice –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∫–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏—é –∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥—Ä–µ–≤–µ—Å–∏–Ω—ã</p>
                    </div>
                    <div class="description-item">
                        <h4>üî¨ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h4>
                        <p>Image –∏ WoodenBoard —Å–≤—è–∑–∞–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º 1:1 –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ AI –∞–Ω–∞–ª–∏–∑–∞</p>
                    </div>
                    <div class="description-item">
                        <h4>üí¨ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</h4>
                        <p>ChatThread –∏ ChatMessage –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
        <div id="sequence" class="diagram-container">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å –∞–Ω–∞–ª–∏–∑–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
            <div class="mermaid">
sequenceDiagram
    participant S as –ü—Ä–æ–¥–∞–≤–µ—Ü
    participant SF as Seller Frontend
    participant API as Backend API
    participant DAO as ProductDAO
    participant DB as PostgreSQL
    participant AI as AI –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
    participant WB as WoodenBoardDAO
    
    S->>SF: –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É —Ç–æ–≤–∞—Ä–∞
    SF->>API: POST /api/v1/products
    API->>DAO: create(product_data)
    DAO->>DB: INSERT INTO products
    DB-->>DAO: product_id
    DAO-->>API: created_product
    API-->>SF: DataResponse[ProductDTO]
    
    S->>SF: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å–∫–∏
    SF->>API: POST /api/v1/wooden-boards/calculate-volume
    Note over API: –î–æ–±–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã height, length
    API->>AI: POST /wooden_boards_volume_seg/
    Note over AI: AI –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    AI-->>API: analysis_results (—Ä–∞–∑–º–µ—Ä—ã, –æ–±—ä–µ–º, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
    API->>WB: create(board_data)
    WB->>DB: INSERT INTO wooden_boards
    DB-->>WB: board_id
    WB-->>API: created_board
    API-->>SF: analysis_response
    SF-->>S: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
            </div>
        </div>

        <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
        <div id="usecase" class="diagram-container">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</div>
            <div class="mermaid">
graph TB
    %% –ê–∫—Ç–µ—Ä—ã
    Buyer[üë§ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å]
    Seller[üè™ –ü—Ä–æ–¥–∞–≤–µ—Ü]
    Admin[üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä]
    AI[ü§ñ AI –°–∏—Å—Ç–µ–º–∞]
    
    %% –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
    UC1[–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ]
    UC2[–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤]
    UC3[–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞]
    UC4[–û–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º]
    UC5[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º]
    
    %% –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞
    UC6[–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤]
    UC7[–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π]
    UC8[–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ—Å–æ–∫]
    UC9[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º]
    UC10[–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂]
    
    %% –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    UC11[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏]
    UC12[–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤]
    UC13[–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã]
    UC14[–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏]
    UC15[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏ –¥—Ä–µ–≤–µ—Å–∏–Ω—ã]
    
    %% –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è AI
    UC16[–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ—Å–æ–∫]
    UC17[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤]
    UC18[–†–∞—Å—á–µ—Ç –æ–±—ä–µ–º–æ–≤]
    
    %% –°–≤—è–∑–∏
    Buyer --> UC1
    Buyer --> UC2
    Buyer --> UC3
    Buyer --> UC4
    Buyer --> UC5
    
    Seller --> UC1
    Seller --> UC6
    Seller --> UC7
    Seller --> UC8
    Seller --> UC9
    Seller --> UC10
    Seller --> UC4
    
    Admin --> UC11
    Admin --> UC12
    Admin --> UC13
    Admin --> UC14
    Admin --> UC15
    
    AI --> UC16
    AI --> UC17
    AI --> UC18
    
    %% –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –≤–∫–ª—é—á–µ–Ω–∏—è
    UC8 ..> UC16 : includes
    UC16 ..> UC17 : includes
    UC17 ..> UC18 : includes
    
    %% –°—Ç–∏–ª–∏
    classDef actor fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef usecase fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class Buyer,Seller,Admin,AI actor
    class UC1,UC2,UC3,UC4,UC5,UC6,UC7,UC8,UC9,UC10,UC11,UC12,UC13,UC14,UC15,UC16,UC17,UC18 usecase
            </div>
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
        <div id="component" class="diagram-container">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</div>
            <div class="mermaid">
graph TB
    subgraph "Frontend Layer"
        AF[Admin Frontend<br/>React:8080]
        SF[Seller Frontend<br/>React:8081]
        BF[Buyer Frontend<br/>React:8082]
    end
    
    subgraph "API Gateway"
        API[Backend API<br/>FastAPI:8000]
        MW[Middleware]
        AUTH[Authentication]
    end
    
    subgraph "Business Logic"
        DAO[DAO Components]
        SVC[Service Components]
        VAL[Validation Components]
    end
    
    subgraph "Data Access"
        MOD[Models]
        DB[PostgreSQL Database]
        MIG[Migrations]
    end
    
    subgraph "External Services"
        KC[Keycloak<br/>Authentication]
        AI[AI Microservice<br/>Image Analysis]
    end
    
    %% –°–≤—è–∑–∏
    AF -->|HTTP REST API| API
    SF -->|HTTP REST API| API
    BF -->|HTTP REST API| API
    
    API --> MW
    API --> AUTH
    API --> DAO
    
    DAO --> SVC
    DAO --> VAL
    DAO --> MOD
    
    MOD --> DB
    MIG --> DB
    
    AUTH -->|OIDC/OAuth2| KC
    API -->|HTTP API| AI
    
    %% –°—Ç–∏–ª–∏
    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef backend fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef data fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class AF,SF,BF frontend
    class API,MW,AUTH,DAO,SVC,VAL backend
    class MOD,DB,MIG data
    class KC,AI external
            </div>
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è -->
        <div id="deployment" class="diagram-container">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è - Docker –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</div>
            <div class="mermaid">
graph TB
    subgraph "Docker Host"
        subgraph "Frontend Containers"
            AC[admin-frontend<br/>:8080]
            SC[seller-frontend<br/>:8081]
            BC[buyer-frontend<br/>:8082]
        end
        
        subgraph "Backend Containers"
            API[backend-api<br/>:8000]
            AI[ai-microservice<br/>:8001]
        end
        
        subgraph "Database Containers"
            PG[postgresql<br/>:5432]
            KC[keycloak<br/>:8080]
        end
        
        subgraph "Networks"
            FN[Frontend Network]
            BN[Backend Network]
            EN[External Network]
        end
    end
    
    subgraph "Artifacts"
        NI[node:18-alpine]
        PI[python:3.11-slim]
        PGI[postgres:15-alpine]
        KCI[quay.io/keycloak/keycloak]
    end
    
    %% –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
    NI -.-> AC
    NI -.-> SC
    NI -.-> BC
    PI -.-> API
    PI -.-> AI
    PGI -.-> PG
    KCI -.-> KC
    
    %% –°–µ—Ç–µ–≤—ã–µ —Å–≤—è–∑–∏
    AC --- FN
    SC --- FN
    BC --- FN
    
    API --- BN
    AI --- BN
    PG --- BN
    KC --- BN
    
    FN --- EN
    BN --- EN
    
    %% –°—Ç–∏–ª–∏
    classDef container fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef network fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef artifact fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    
    class AC,SC,BC,API,AI,PG,KC container
    class FN,BN,EN network
    class NI,PI,PGI,KCI artifact
            </div>
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π -->
        <div id="state" class="diagram-container">
            <div class="diagram-title">–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–æ–≤–∞—Ä–∞</div>
            <div class="mermaid">
stateDiagram-v2
    [*] --> –°–æ–∑–¥–∞–Ω : –ü—Ä–æ–¥–∞–≤–µ—Ü —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä
    
    –°–æ–∑–¥–∞–Ω --> –ß–µ—Ä–Ω–æ–≤–∏–∫ : –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    –°–æ–∑–¥–∞–Ω --> –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏ : –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
    
    –ß–µ—Ä–Ω–æ–≤–∏–∫ --> –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏ : –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
    –ß–µ—Ä–Ω–æ–≤–∏–∫ --> –£–¥–∞–ª–µ–Ω : –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞
    
    –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏ --> –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω : –û–¥–æ–±—Ä–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º
    –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏ --> –û—Ç–∫–ª–æ–Ω–µ–Ω : –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º
    
    –û—Ç–∫–ª–æ–Ω–µ–Ω --> –ß–µ—Ä–Ω–æ–≤–∏–∫ : –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    –û—Ç–∫–ª–æ–Ω–µ–Ω --> –£–¥–∞–ª–µ–Ω : –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
    
    –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω --> –ê–∫—Ç–∏–≤–µ–Ω : –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥–∞–≤—Ü–æ–º
    –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω --> –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω : –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
    
    –ê–∫—Ç–∏–≤–µ–Ω --> –ü—Ä–æ–¥–∞–Ω : –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞
    –ê–∫—Ç–∏–≤–µ–Ω --> –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω : –°–Ω—è—Ç–∏–µ —Å –ø—Ä–æ–¥–∞–∂–∏
    –ê–∫—Ç–∏–≤–µ–Ω --> –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏ : –ñ–∞–ª–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    
    –ü—Ä–æ–¥–∞–Ω --> –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω : –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
    
    –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω --> –ê–∫—Ç–∏–≤–µ–Ω : –í–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–æ–¥–∞–∂—É
    –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω --> –£–¥–∞–ª–µ–Ω : –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
    
    –£–¥–∞–ª–µ–Ω --> [*] : –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
    
    note right of –ù–∞–ú–æ–¥–µ—Ä–∞—Ü–∏–∏
        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
        - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        - –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
    end note
    
    note right of –ê–∫—Ç–∏–≤–µ–Ω
        –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è:
        - –ü–æ–∏—Å–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏
        - –î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        - –°–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–æ–≤
    end note
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#1e293b',
                primaryBorderColor: '#3b82f6',
                lineColor: '#64748b',
                sectionBkgColor: '#f8fafc',
                altSectionBkgColor: '#e2e8f0',
                gridColor: '#cbd5e1',
                secondaryColor: '#f1f5f9',
                tertiaryColor: '#f8fafc'
            },
            classDiagram: {
                diagramPadding: 20,
                htmlLabels: true
            },
            sequenceDiagram: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35
            },
            stateDiagram: {
                diagramPadding: 20
            }
        });

        function showDiagram(diagramId) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
            const diagrams = document.querySelectorAll('.diagram-container');
            diagrams.forEach(diagram => diagram.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
            document.getElementById(diagramId).classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        function resetZoom() {
            const activeDiagram = document.querySelector('.diagram-container.active .mermaid svg');
            if (activeDiagram) {
                activeDiagram.style.transform = 'scale(1)';
                activeDiagram.style.transformOrigin = 'center top';
            }
        }

        function downloadCurrentDiagram() {
            const activeDiagram = document.querySelector('.diagram-container.active .mermaid svg');
            if (activeDiagram) {
                const svgData = new XMLSerializer().serializeToString(activeDiagram);
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                    
                    const activeContainer = document.querySelector('.diagram-container.active');
                    const title = activeContainer.querySelector('.diagram-title').textContent;
                    const filename = `WoodenBoardsShop_UML_${title.replace(/\s+/g, '_').replace(/[^\w]/g, '')}.png`;
                    
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = canvas.toDataURL();
                    link.click();
                };
                
                img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
        document.addEventListener('wheel', function(e) {
            if (e.ctrlKey) {
                e.preventDefault();
                const activeDiagram = document.querySelector('.diagram-container.active .mermaid svg');
                if (activeDiagram) {
                    const currentScale = activeDiagram.style.transform.match(/scale\(([^)]+)\)/);
                    let scale = currentScale ? parseFloat(currentScale[1]) : 1;
                    
                    scale += e.deltaY > 0 ? -0.1 : 0.1;
                    scale = Math.max(0.5, Math.min(3, scale));
                    
                    activeDiagram.style.transform = `scale(${scale})`;
                    activeDiagram.style.transformOrigin = 'center top';
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
            resetZoom();
        }, 1000);
    </script>
</body>
</html>
