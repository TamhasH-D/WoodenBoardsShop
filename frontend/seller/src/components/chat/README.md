# Seller Chat System

Профессиональная система чата для продавцов с полноценной WebSocket интеграцией и современным дизайном.

## Архитектура

### Основные компоненты

- **ChatContainer** - Главный контейнер чата с адаптивным дизайном
- **ChatSidebar** - Боковая панель со списком чатов и поиском
- **ChatWindow** - Окно сообщений с автоскроллом и индикаторами
- **MessageBubble** - Компонент отдельного сообщения
- **MessageInput** - Поле ввода с автоматическим изменением размера
- **ChatSettings** - Модальное окно настроек

### Индикаторы статуса

- **ConnectionStatus** - Статус подключения к WebSocket
- **TypingIndicator** - Индикатор печатания
- **OnlineStatus** - Статус онлайн пользователя
- **MessageStatus** - Статус доставки сообщения
- **UnreadBadge** - Счетчик непрочитанных сообщений

### Оптимизация производительности

- **VirtualizedMessageList** - Виртуализированный список сообщений для больших объемов
- **VirtualizedThreadList** - Виртуализированный список чатов
- Мемоизация компонентов и данных
- Дебаунсинг и троттлинг событий
- Ленивая загрузка изображений

## Хуки

### useChat
Основной хук для работы с чатом:
```javascript
const {
  threads,
  selectedThread,
  messages,
  loading,
  isConnected,
  selectThread,
  sendMessage,
  sendTypingIndicator
} = useChat();
```

### useNotifications
Управление уведомлениями:
```javascript
const {
  notifyNewMessage,
  notifyMessageSent,
  toggleSounds,
  toggleNotifications
} = useNotifications();
```

### useAutoScroll
Автоматическая прокрутка сообщений:
```javascript
const {
  messagesEndRef,
  containerRef,
  scrollToBottom
} = useAutoScroll(messages);
```

## WebSocket Manager

Централизованный менеджер WebSocket соединений:

### Особенности
- Автоматическое переподключение с экспоненциальной задержкой
- Обработка множественных соединений
- Ping/pong для поддержания соединения
- Обработка ошибок и таймаутов

### Использование
```javascript
import websocketManager from '../services/websocketManager';

// Подключение
websocketManager.connect(threadId, userId, 'seller', onConnectionChange);

// Отправка сообщения
websocketManager.sendMessage(threadId, messageData);

// Добавление обработчика
websocketManager.addMessageHandler(threadId, handleMessage);
```

## Звуковые уведомления

### Типы звуков
- `NEW_MESSAGE` - Новое сообщение
- `MESSAGE_SENT` - Сообщение отправлено
- `CONNECT` - Подключение
- `DISCONNECT` - Отключение
- `ERROR` - Ошибка

### Использование
```javascript
import { playSound, SOUNDS } from '../utils/soundUtils';

playSound(SOUNDS.NEW_MESSAGE);
```

## Настройки

Пользователь может настроить:
- Браузерные уведомления
- Звуковые уведомления
- Громкость звуков
- Автоскролл
- Отображение времени

Настройки сохраняются в localStorage.

## Адаптивный дизайн

- Мобильная версия с полноэкранным режимом
- Автоматическое скрытие боковой панели на мобильных устройствах
- Кнопка "Назад" для возврата к списку чатов

## Производительность

### Виртуализация
- Автоматически включается для списков > 20 чатов
- Автоматически включается для > 50 сообщений
- Настраиваемая высота элементов и область просмотра

### Мемоизация
- Мемоизация отфильтрованных чатов
- Мемоизация обработанных сообщений
- Мемоизация обработчиков событий

### Оптимизация ререндеров
- React.memo для всех компонентов
- useCallback для обработчиков
- useMemo для вычисляемых значений

## Стилизация

### Дизайн-система
- Профессиональная цветовая схема
- Современные тени и скругления
- Плавные анимации и переходы
- Консистентная типографика

### Анимации
- Появление сообщений
- Индикатор печатания
- Пульсация непрочитанных сообщений
- Hover эффекты

## Безопасность

- Валидация входящих сообщений
- Санитизация пользовательского ввода
- Ограничение длины сообщений
- Защита от XSS атак

## Тестирование

Рекомендуется тестировать:
- Отправку и получение сообщений
- Переподключение WebSocket
- Работу уведомлений
- Производительность с большими списками
- Адаптивность на разных устройствах

## Развертывание

1. Убедитесь, что WebSocket сервер настроен
2. Проверьте URL подключения в `websocket.js`
3. Настройте уведомления в браузере
4. Протестируйте на разных устройствах

## Поддержка браузеров

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

Для старых браузеров предусмотрены fallback'и для:
- Web Audio API
- Intersection Observer
- WebSocket
