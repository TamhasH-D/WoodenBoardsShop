# Тест-кейсы: Сквозные пользовательские сценарии

## TC-E2E-001: Полный цикл создания и продажи продукта
**Приоритет**: Критический  
**Теги**: `#e2e` `#integration` `#full_cycle` `#critical`

### Предусловия
- Все сервисы запущены и доступны
- Существуют аккаунты продавца и покупателя в Keycloak
- База данных пуста или в начальном состоянии

### Шаги выполнения

#### Этап 1: Продавец создает продукт
1. Продавец авторизуется в Seller Frontend
2. Переходит в раздел "Мои продукты"
3. Создает новый продукт:
   - Название: "Доски сосновые строительные"
   - Описание: "Качественные сосновые доски для строительства"
   - Объем: 5.0 м³
   - Цена: 35000 ₽
   - Тип древесины: Сосна
4. Загружает изображение досок
5. Использует AI-анализ для определения количества досок
6. Сохраняет продукт

#### Этап 2: Покупатель находит продукт
7. Покупатель открывает Buyer Frontend
8. Просматривает каталог продуктов
9. Использует поиск по слову "сосна"
10. Находит созданный продукт
11. Просматривает детали продукта

#### Этап 3: Коммуникация между пользователями
12. Покупатель инициирует чат с продавцом
13. Отправляет сообщение: "Интересует ваш товар. Возможна ли доставка?"
14. Продавец получает уведомление о новом сообщении
15. Продавец отвечает: "Да, доставка возможна. Стоимость 2000 ₽"

#### Этап 4: Администратор мониторит систему
16. Администратор авторизуется в Admin Frontend
17. Проверяет созданный продукт в разделе "Продукты"
18. Просматривает чат-поток в разделе "Чат-потоки"
19. Проверяет активность пользователей

### Ожидаемый результат
- Продукт успешно создан и отображается во всех интерфейсах
- AI-анализ корректно определил количество досок
- Изображение загружено и отображается
- Поиск находит продукт по ключевому слову
- Чат работает в обе стороны
- Все данные синхронизированы между сервисами
- Администратор видит полную картину активности

---

## TC-E2E-002: Сценарий использования AI-анализатора покупателем
**Приоритет**: Высокий  
**Теги**: `#e2e` `#ai` `#buyer` `#analysis` `#high`

### Предусловия
- Все сервисы запущены, включая AI-сервисы
- Покупатель авторизован в системе
- В каталоге есть продукты разных объемов

### Шаги выполнения

#### Этап 1: Покупатель анализирует свои доски
1. Покупатель переходит в раздел "Анализатор досок"
2. Загружает фотографию своих досок
3. Указывает параметры:
   - Высота: 5 см
   - Длина: 250 см
4. Запускает AI-анализ
5. Получает результат: обнаружено 8 досок, общий объем 1.5 м³

#### Этап 2: Поиск подходящих продуктов
6. Использует результат анализа для поиска
7. Фильтрует продукты по объему: от 1.0 до 2.0 м³
8. Сортирует по цене за м³
9. Находит несколько подходящих вариантов

#### Этап 3: Сравнение и выбор
10. Сравнивает 3 продукта по характеристикам
11. Выбирает оптимальный по соотношению цена/качество
12. Связывается с продавцом через чат

#### Этап 4: Проверка в админ-панели
13. Администратор проверяет логи AI-анализа
14. Убеждается в корректности работы алгоритмов
15. Проверяет статистику использования AI-сервисов

### Ожидаемый результат
- AI корректно определил количество и объем досок
- Результаты анализа использованы для поиска
- Фильтрация работает на основе AI-данных
- Покупатель нашел подходящий продукт
- Все AI-операции залогированы
- Производительность AI-сервисов приемлемая

---

## TC-E2E-003: Массовое управление продуктами продавцом
**Приоритет**: Средний  
**Теги**: `#e2e` `#seller` `#bulk_operations` `#medium`

### Предусловия
- Продавец авторизован в системе
- У продавца есть несколько продуктов

### Шаги выполнения

#### Этап 1: Создание нескольких продуктов
1. Продавец создает 5 различных продуктов:
   - Доски сосновые 50x150
   - Доски березовые 40x120
   - Доски дубовые 60x200
   - Доски липовые 30x100
   - Доски осиновые 45x140
2. Для каждого продукта загружает изображения
3. Использует AI-анализ для определения параметров

#### Этап 2: Массовые операции
4. Выбирает все сосновые и березовые доски
5. Применяет скидку 10% к выбранным продуктам
6. Обновляет описания для всех продуктов
7. Изменяет условия доставки для группы продуктов

#### Этап 3: Анализ и статистика
8. Просматривает статистику продаж
9. Анализирует популярность типов древесины
10. Экспортирует данные о продуктах в Excel

#### Этап 4: Проверка изменений
11. Покупатель проверяет обновленные цены в каталоге
12. Администратор проверяет корректность массовых изменений
13. Убеждается в целостности данных

### Ожидаемый результат
- Все продукты созданы корректно
- Массовые операции применены правильно
- Цены обновлены с учетом скидок
- Статистика отражает реальные данные
- Экспорт содержит актуальную информацию
- Изменения видны всем пользователям

---

## TC-E2E-004: Сценарий работы администратора с системой
**Приоритет**: Высокий  
**Теги**: `#e2e` `#admin` `#management` `#high`

### Предусловия
- Администратор авторизован в системе
- В системе есть активные пользователи и данные

### Шаги выполнения

#### Этап 1: Мониторинг системы
1. Администратор проверяет статус всех сервисов
2. Просматривает логи ошибок за последние 24 часа
3. Проверяет производительность AI-сервисов
4. Анализирует использование ресурсов

#### Этап 2: Управление пользователями
5. Просматривает список активных покупателей
6. Проверяет список продавцов и их продукты
7. Анализирует активность пользователей
8. Блокирует подозрительного пользователя (тестового)

#### Этап 3: Управление контентом
9. Модерирует новые продукты
10. Проверяет качество загруженных изображений
11. Валидирует описания продуктов
12. Удаляет неподходящий контент

#### Этап 4: Аналитика и отчеты
13. Генерирует отчет по продажам
14. Анализирует популярные типы древесины
15. Проверяет эффективность AI-анализа
16. Создает резервную копию базы данных

### Ожидаемый результат
- Все сервисы работают стабильно
- Пользователи управляются корректно
- Контент соответствует стандартам качества
- Отчеты содержат актуальные данные
- Резервная копия создана успешно
- Система готова к продуктивной работе

---

## TC-E2E-005: Стресс-тестирование полного цикла
**Приоритет**: Средний  
**Теги**: `#e2e` `#stress` `#performance` `#medium`

### Предусловия
- Все сервисы запущены
- Подготовлены тестовые данные для нагрузки

### Шаги выполнения

#### Этап 1: Создание нагрузки
1. 10 продавцов одновременно создают продукты
2. 50 покупателей просматривают каталог
3. 20 пользователей используют AI-анализ
4. 30 чат-сессий активны одновременно

#### Этап 2: Мониторинг производительности
5. Измерение времени отклика API
6. Мониторинг использования CPU и памяти
7. Проверка стабильности базы данных
8. Анализ пропускной способности AI-сервисов

#### Этап 3: Проверка целостности данных
9. Все созданные продукты сохранены корректно
10. Чат-сообщения доставлены без потерь
11. AI-анализ выполнен для всех запросов
12. Нет дублирования или потери данных

#### Этап 4: Восстановление после нагрузки
13. Система возвращается к нормальной работе
14. Все сервисы остаются стабильными
15. Производительность восстанавливается
16. Нет утечек памяти или ресурсов

### Ожидаемый результат
- Система выдерживает заданную нагрузку
- Время отклика остается приемлемым (< 5 сек)
- Все данные сохранены корректно
- Нет критических ошибок или сбоев
- Система масштабируется под нагрузкой
- Восстановление происходит автоматически

---

## TC-E2E-006: Сценарий восстановления после сбоя
**Приоритет**: Высокий  
**Теги**: `#e2e` `#recovery` `#reliability` `#high`

### Предусловия
- Система работает в нормальном режиме
- Есть активные пользовательские сессии

### Шаги выполнения

#### Этап 1: Имитация сбоя
1. Остановить один из AI-сервисов
2. Пользователи пытаются использовать AI-анализ
3. Проверить обработку ошибок в интерфейсах
4. Восстановить AI-сервис

#### Этап 2: Сбой базы данных
5. Имитировать недоступность базы данных
6. Проверить поведение всех интерфейсов
7. Восстановить подключение к базе данных
8. Проверить восстановление функциональности

#### Этап 3: Сбой основного API
9. Остановить backend API
10. Проверить отображение ошибок в фронтендах
11. Запустить API обратно
12. Убедиться в полном восстановлении

#### Этап 4: Проверка целостности
13. Все пользовательские данные сохранены
14. Сессии восстановлены корректно
15. Нет потери функциональности
16. Система работает стабильно

### Ожидаемый результат
- Ошибки обрабатываются корректно
- Пользователи получают понятные сообщения
- Система автоматически восстанавливается
- Данные не теряются при сбоях
- Функциональность полностью восстанавливается
- Логи содержат информацию о сбоях
