# Тест-кейсы: Расчет объема древесины

## TC-AI-VOL-001: Расчет объема с корректными параметрами
**Приоритет**: Критический  
**Теги**: `#ai` `#volume` `#calculation` `#critical`

### Предусловия
- AI-сервис расчета объема запущен на порту 8001
- Подготовлено изображение с досками
- Известны реальные размеры досок

### Шаги выполнения
1. Отправить POST запрос на `http://localhost:8001/wooden_boards_volume_seg/`
2. Параметры запроса:
   - `height`: 5.0 (см)
   - `length`: 300.0 (см)
3. Приложить файл изображения в поле `image`
4. Дождаться ответа с расчетами

### Ожидаемый результат
- Статус ответа: 200 OK
- Ответ содержит:
  - `total_volume`: общий объем в м³
  - `board_count`: количество обнаруженных досок
  - `wooden_boards`: массив досок с индивидуальными объемами
- Расчет объема корректен: V = height × width × length / 1,000,000

### Пример ожидаемого ответа
```json
{
  "total_volume": 0.045,
  "board_count": 2,
  "wooden_boards": [
    {
      "width": 15.0,
      "volume": 0.0225,
      "coordinates": [[100, 50], [200, 50], [200, 100], [100, 100]]
    },
    {
      "width": 15.0,
      "volume": 0.0225,
      "coordinates": [[220, 50], [320, 50], [320, 100], [220, 100]]
    }
  ]
}
```

---

## TC-AI-VOL-002: Расчет объема с различными размерами досок
**Приоритет**: Высокий  
**Теги**: `#ai` `#volume` `#calculation` `#variety` `#high`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлены изображения с досками разной ширины

### Шаги выполнения
1. Отправить изображение с узкими досками (width ~10 см)
   - height: 5.0 см, length: 300.0 см
2. Отправить изображение с широкими досками (width ~20 см)
   - height: 5.0 см, length: 300.0 см
3. Сравнить результаты расчетов

### Ожидаемый результат
- Ширина досок определяется автоматически по изображению
- Объем рассчитывается индивидуально для каждой доски
- Узкие доски: V ≈ 5 × 10 × 300 / 1,000,000 = 0.015 м³
- Широкие доски: V ≈ 5 × 20 × 300 / 1,000,000 = 0.030 м³
- Общий объем = сумма объемов всех досок

---

## TC-AI-VOL-003: Валидация входных параметров
**Приоритет**: Высокий  
**Теги**: `#ai` `#volume` `#validation` `#negative` `#high`

### Предусловия
- AI-сервис расчета объема запущен

### Шаги выполнения
1. Отправить запрос с отрицательной высотой: `height=-5.0`
2. Отправить запрос с нулевой длиной: `length=0`
3. Отправить запрос без параметров
4. Отправить запрос с очень большими значениями: `height=1000, length=10000`

### Ожидаемый результат
- Отрицательные значения: 400 Bad Request
- Нулевые значения: 400 Bad Request или предупреждение
- Отсутствие параметров: 422 Unprocessable Entity
- Очень большие значения: предупреждение или ограничение
- Понятные сообщения об ошибках

---

## TC-AI-VOL-004: Обработка изображений без досок
**Приоритет**: Средний  
**Теги**: `#ai` `#volume` `#calculation` `#empty` `#medium`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлено изображение без досок

### Шаги выполнения
1. Отправить изображение пустой комнаты
2. Указать параметры: height=5.0, length=300.0
3. Проверить ответ сервиса

### Ожидаемый результат
- Статус ответа: 200 OK
- Ответ содержит:
  - `total_volume`: 0.0
  - `board_count`: 0
  - `wooden_boards`: пустой массив []
- Нет ошибок обработки

---

## TC-AI-VOL-005: Точность определения ширины досок
**Приоритет**: Высокий  
**Теги**: `#ai` `#volume` `#width_detection` `#accuracy` `#high`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлено изображение с досками известной ширины

### Шаги выполнения
1. Использовать изображение с досками ширины 15 см
2. Отправить на анализ с height=5.0, length=300.0
3. Проверить определенную ширину в ответе
4. Сравнить с реальной шириной

### Ожидаемый результат
- Определенная ширина близка к реальной (±2 см)
- Погрешность не превышает 15%
- Ширина определяется для каждой доски индивидуально
- Результат стабилен при повторных запросах

---

## TC-AI-VOL-006: Производительность расчета объема
**Приоритет**: Средний  
**Теги**: `#ai` `#volume` `#performance` `#medium`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлены изображения разного размера и сложности

### Шаги выполнения
1. Отправить простое изображение (5 досок, 1MP)
2. Измерить время обработки
3. Отправить сложное изображение (20 досок, 5MP)
4. Измерить время обработки
5. Сравнить производительность

### Ожидаемый результат
- Простое изображение: обработка < 3 секунд
- Сложное изображение: обработка < 8 секунд
- Время растет пропорционально сложности
- Память освобождается после обработки
- CPU нагрузка в разумных пределах

---

## TC-AI-VOL-007: Расчет объема для досок разной толщины
**Приоритет**: Средний  
**Теги**: `#ai` `#volume` `#thickness` `#medium`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлены изображения досок

### Шаги выполнения
1. Рассчитать объем для тонких досок: height=2.5 см
2. Рассчитать объем для толстых досок: height=10.0 см
3. Сравнить результаты при одинаковой ширине и длине

### Ожидаемый результат
- Объем пропорционален толщине
- Тонкие доски: V = 2.5 × width × 300 / 1,000,000
- Толстые доски: V = 10.0 × width × 300 / 1,000,000
- Соотношение объемов = 4:1
- Расчеты математически корректны

---

## TC-AI-VOL-008: Обработка изображений с плохим качеством
**Приоритет**: Средний  
**Теги**: `#ai` `#volume` `#quality` `#medium`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлены изображения разного качества

### Шаги выполнения
1. Отправить размытое изображение
2. Отправить изображение с плохим освещением
3. Отправить изображение с шумом
4. Сравнить точность расчетов

### Ожидаемый результат
- Сервис обрабатывает все изображения
- Точность может снижаться при плохом качестве
- Количество обнаруженных досок может быть меньше
- Нет критических ошибок или сбоев
- Предупреждения о низком качестве (опционально)

---

## TC-AI-VOL-009: Интеграция с детекцией досок
**Приоритет**: Критический  
**Теги**: `#ai` `#volume` `#integration` `#detection` `#critical`

### Предусловия
- AI-сервис расчета объема запущен
- AI-сервис детекции досок запущен
- Сервисы интегрированы

### Шаги выполнения
1. Отправить изображение на расчет объема
2. Проверить, что используется детекция досок
3. Сравнить координаты досок с результатами детекции
4. Убедиться в согласованности данных

### Ожидаемый результат
- Расчет объема использует результаты детекции
- Координаты досок совпадают
- Количество досок одинаково в обоих сервисах
- Интеграция работает без ошибок
- Данные передаются корректно

---

## TC-AI-VOL-010: Обработка больших изображений
**Приоритет**: Средний  
**Теги**: `#ai` `#volume` `#large_images` `#medium`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлены изображения большого размера (>5MP)

### Шаги выполнения
1. Отправить изображение 4K разрешения
2. Отправить изображение 8K разрешения (если поддерживается)
3. Проверить обработку и результаты
4. Мониторить использование ресурсов

### Ожидаемый результат
- Большие изображения обрабатываются успешно
- Время обработки увеличивается пропорционально размеру
- Память используется эффективно
- Нет переполнения памяти или таймаутов
- Качество детекции не ухудшается

---

## TC-AI-VOL-011: Математическая точность расчетов
**Приоритет**: Высокий  
**Теги**: `#ai` `#volume` `#accuracy` `#math` `#high`

### Предусловия
- AI-сервис расчета объема запущен
- Подготовлено изображение с известными параметрами досок

### Шаги выполнения
1. Отправить изображение с 3 досками
2. Параметры: height=5.0, length=300.0
3. Предположим, ширина досок: 10, 15, 20 см
4. Проверить математическую точность

### Ожидаемый результат
- Объем доски 1: 5 × 10 × 300 / 1,000,000 = 0.015 м³
- Объем доски 2: 5 × 15 × 300 / 1,000,000 = 0.0225 м³
- Объем доски 3: 5 × 20 × 300 / 1,000,000 = 0.030 м³
- Общий объем: 0.0675 м³
- Погрешность расчетов < 1%

---

## TC-AI-VOL-012: Обработка ошибок и исключений
**Приоритет**: Высокий  
**Теги**: `#ai` `#volume` `#error_handling` `#high`

### Предусловия
- AI-сервис расчета объема запущен

### Шаги выполнения
1. Отправить поврежденный файл изображения
2. Отправить файл неподдерживаемого формата
3. Отправить запрос без изображения
4. Имитировать сбой в детекции досок

### Ожидаемый результат
- Все ошибки обрабатываются корректно
- Возвращаются понятные сообщения об ошибках
- Сервис остается стабильным
- Нет утечек памяти или зависаний
- Логирование ошибок для отладки
