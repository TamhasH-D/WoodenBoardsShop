# Тест-кейсы: Тестирование безопасности

## TC-SEC-001: Тестирование аутентификации и авторизации
**Приоритет**: Критический  
**Теги**: `#security` `#auth` `#keycloak` `#critical`

### Предусловия
- Keycloak настроен и запущен
- Созданы тестовые пользователи с разными ролями
- Все фронтенды интегрированы с Keycloak

### Шаги выполнения

#### Этап 1: Тестирование аутентификации
1. Попытка доступа к защищенным ресурсам без токена
2. Использование недействительного токена
3. Использование истекшего токена
4. Попытка подделки токена
5. Тестирование различных методов аутентификации

#### Этап 2: Тестирование авторизации
6. Покупатель пытается получить доступ к админ-панели
7. Продавец пытается редактировать чужие продукты
8. Неавторизованный пользователь пытается создать продукт
9. Проверка ролевой модели доступа

#### Этап 3: Тестирование сессий
10. Множественные сессии одного пользователя
11. Принудительное завершение сессии
12. Тестирование таймаутов сессий
13. Проверка безопасного выхода

### Ожидаемые результаты
- Неавторизованные запросы возвращают 401 Unauthorized
- Недостаточные права возвращают 403 Forbidden
- Токены валидируются корректно
- Роли пользователей соблюдаются строго
- Сессии управляются безопасно

---

## TC-SEC-002: Тестирование SQL-инъекций
**Приоритет**: Критический  
**Теги**: `#security` `#sql_injection` `#database` `#critical`

### Предусловия
- Backend API запущен и доступен
- База данных содержит тестовые данные
- Подготовлены SQL-инъекции различных типов

### Шаги выполнения

#### Этап 1: Тестирование параметров запроса
1. Отправить запрос с SQL-инъекцией в параметре ID:
   `GET /api/v1/products/1'; DROP TABLE products; --`
2. Тестировать поисковые параметры:
   `GET /api/v1/products?search='; DELETE FROM products; --`
3. Проверить фильтры:
   `GET /api/v1/products?wood_type=' OR '1'='1`

#### Этап 2: Тестирование тела запроса
4. Отправить POST запрос с инъекцией в JSON:
```json
{
  "name": "'; DROP TABLE products; --",
  "description": "Normal description"
}
```
5. Тестировать PATCH запросы с инъекциями
6. Проверить массовые операции

#### Этап 3: Тестирование сложных инъекций
7. Union-based инъекции
8. Boolean-based blind инъекции
9. Time-based blind инъекции
10. Second-order инъекции

### Ожидаемые результаты
- Все SQL-инъекции блокируются
- Параметры корректно экранируются
- Используются подготовленные запросы
- База данных остается неповрежденной
- Логируются попытки атак

---

## TC-SEC-003: Тестирование XSS (Cross-Site Scripting)
**Приоритет**: Высокий  
**Теги**: `#security` `#xss` `#frontend` `#high`

### Предусловия
- Все фронтенды доступны
- Подготовлены различные XSS-пейлоады
- Настроены инструменты для обнаружения XSS

### Шаги выполнения

#### Этап 1: Reflected XSS
1. Тестировать поисковые формы:
   `search=<script>alert('XSS')</script>`
2. Проверить параметры URL:
   `?name=<img src=x onerror=alert('XSS')>`
3. Тестировать сообщения об ошибках

#### Этап 2: Stored XSS
4. Создать продукт с XSS в названии:
   `<script>alert('Stored XSS')</script>`
5. Отправить сообщение в чат с XSS-пейлоадом
6. Загрузить изображение с XSS в метаданных

#### Этап 3: DOM-based XSS
7. Тестировать JavaScript обработчики
8. Проверить динамическое содержимое
9. Анализировать клиентские скрипты

### Ожидаемые результаты
- Все пользовательские данные экранируются
- XSS-пейлоады не выполняются
- Content Security Policy настроен
- Входные данные валидируются
- Опасные теги фильтруются

---

## TC-SEC-004: Тестирование загрузки файлов
**Приоритет**: Высокий  
**Теги**: `#security` `#file_upload` `#malware` `#high`

### Предусловия
- Функция загрузки изображений доступна
- Подготовлены тестовые файлы различных типов
- Настроен антивирус (если используется)

### Шаги выполнения

#### Этап 1: Тестирование типов файлов
1. Загрузить исполняемый файл (.exe, .sh)
2. Загрузить скрипт (.php, .js, .py)
3. Загрузить файл с двойным расширением (.jpg.php)
4. Загрузить файл без расширения

#### Этап 2: Тестирование размеров файлов
5. Загрузить файл размером 0 байт
6. Загрузить очень большой файл (>100MB)
7. Тестировать ограничения размера

#### Этап 3: Тестирование содержимого
8. Загрузить изображение с вредоносным кодом в EXIF
9. Загрузить поддельное изображение (переименованный .exe)
10. Тестировать полиглот-файлы

### Ожидаемые результаты
- Только разрешенные типы файлов принимаются
- Размеры файлов ограничены
- Содержимое файлов валидируется
- Вредоносные файлы блокируются
- Файлы сохраняются в безопасном месте

---

## TC-SEC-005: Тестирование CSRF (Cross-Site Request Forgery)
**Приоритет**: Высокий  
**Теги**: `#security` `#csrf` `#api` `#high`

### Предусловия
- Пользователь авторизован в системе
- Подготовлены CSRF-атаки
- Настроены CSRF-токены (если используются)

### Шаги выполнения

#### Этап 1: Тестирование GET запросов
1. Создать вредоносную страницу с изображением:
   `<img src="http://localhost:8000/api/v1/products/delete/123">`
2. Проверить выполнение запроса при посещении страницы

#### Этап 2: Тестирование POST запросов
3. Создать форму для автоматической отправки:
```html
<form action="http://localhost:8000/api/v1/products" method="POST">
  <input name="name" value="Malicious Product">
  <input type="submit" value="Submit">
</form>
<script>document.forms[0].submit();</script>
```

#### Этап 3: Тестирование AJAX запросов
4. Использовать JavaScript для отправки запросов
5. Тестировать различные Content-Type
6. Проверить обход CORS

### Ожидаемые результаты
- CSRF-токены валидируются
- Опасные операции защищены
- CORS настроен корректно
- SameSite cookies используются
- Referer заголовки проверяются

---

## TC-SEC-006: Тестирование API безопасности
**Приоритет**: Критический  
**Теги**: `#security` `#api` `#rate_limiting` `#critical`

### Предусловия
- Backend API запущен
- Настроены ограничения скорости (если есть)
- Подготовлены инструменты для автоматизации

### Шаги выполнения

#### Этап 1: Тестирование Rate Limiting
1. Отправить 1000 запросов за минуту
2. Проверить блокировку по IP
3. Тестировать различные эндпоинты

#### Этап 2: Тестирование информационных утечек
4. Анализировать заголовки ответов
5. Проверить сообщения об ошибках
6. Тестировать debug информацию

#### Этап 3: Тестирование HTTP методов
7. Использовать неподдерживаемые методы (TRACE, OPTIONS)
8. Проверить HTTP verb tampering
9. Тестировать method override

### Ожидаемые результаты
- Rate limiting работает корректно
- Чувствительная информация не раскрывается
- Только необходимые HTTP методы разрешены
- Заголовки безопасности настроены
- API документация не содержит секретов

---

## TC-SEC-007: Тестирование безопасности AI-сервисов
**Приоритет**: Высокий  
**Теги**: `#security` `#ai` `#adversarial` `#high`

### Предусловия
- AI-сервисы запущены и доступны
- Подготовлены специальные изображения для тестирования
- Настроен мониторинг AI-сервисов

### Шаги выполнения

#### Этап 1: Тестирование входных данных
1. Отправить изображения с вредоносными метаданными
2. Загрузить очень большие изображения
3. Тестировать поврежденные файлы

#### Этап 2: Adversarial атаки
4. Использовать adversarial примеры
5. Тестировать изображения с шумом
6. Проверить устойчивость к манипуляциям

#### Этап 3: Тестирование DoS атак
7. Отправить множество одновременных запросов
8. Использовать изображения, требующие много ресурсов
9. Тестировать memory exhaustion

### Ожидаемые результаты
- AI-сервисы устойчивы к атакам
- Входные данные валидируются
- Ресурсы используются контролируемо
- Adversarial примеры обрабатываются корректно
- DoS атаки не приводят к сбоям

---

## TC-SEC-008: Тестирование конфиденциальности данных
**Приоритет**: Критический  
**Теги**: `#security` `#privacy` `#data_protection` `#critical`

### Предусловия
- Система содержит персональные данные пользователей
- Настроены права доступа к данным
- Подготовлены сценарии для тестирования

### Шаги выполнения

#### Этап 1: Тестирование доступа к данным
1. Попытка доступа к чужим персональным данным
2. Проверка утечек данных в логах
3. Тестирование API на раскрытие информации

#### Этап 2: Тестирование шифрования
4. Проверить шифрование паролей в базе данных
5. Анализировать передачу данных по сети
6. Тестировать хранение чувствительных данных

#### Этап 3: Тестирование удаления данных
7. Проверить полное удаление пользовательских данных
8. Тестировать очистку временных файлов
9. Анализировать резервные копии

### Ожидаемые результаты
- Персональные данные защищены
- Доступ ограничен по ролям
- Чувствительные данные зашифрованы
- Удаление данных происходит полностью
- Логи не содержат секретной информации
